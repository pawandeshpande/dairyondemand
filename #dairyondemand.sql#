SELECT 'DROPPING DATABASE DAIRYONDEMAND' AS ' ';
DROP DATABASE IF EXISTS DAIRYONDEMAND;


DROP USER  'TESTCRMCORE'@'LOCALHOST';
CREATE USER 'TESTCRMCORE'@'LOCALHOST' IDENTIFIED BY 'TESTCRMCORE';
GRANT SELECT,INSERT,UPDATE,DELETE,CREATE   ON DAIRYONDEMAND.*   TO 'TESTCRMCORE'@'LOCALHOST';

SELECT 'CREATING DATABASE DAIRYONDEMAND' AS ' ';
CREATE DATABASE DAIRYONDEMAND;

USE DAIRYONDEMAND;

SELECT 'DROPPING THE TABLES' AS ' ';
DROP TABLE IF EXISTS DOD_COMPANY;  SELECT 'DROPPING APARTMENT COMPLEX/SOCIETY/GROUP ';
 DROP TABLE IF EXISTS DOD_ORD_PREF; SELECT 'DROPPING PRODUCT PREFERENCE TABLE, WHICH WILL LET THE VENDOR KNOW WHAT THE PRODUCT PREFERENCES OF THE USER ARE.'; 
 DROP TABLE IF EXISTS DOD_ORDER; SELECT 'DROPPING ORDER TABLE'; 
 DROP TABLE IF EXISTS DOD_ORDER_DETAILS; SELECT 'DROPPING ORDER DETAILS TABLE.'; 
 DROP TABLE IF EXISTS DOD_ORDER_TRACK; SELECT 'DROPPING ORDER STATUS TABLE'; 
DROP TABLE IF EXISTS DOD_ORDER_DETAILS_TRACK; SELECT 'DROPPING ORDER DETAILS TRACK TABLE'; 
 DROP TABLE IF EXISTS DOD_PRD_MASTER; SELECT 'DROPPING PRODUCT MASTER TABLE.';
 DROP TABLE IF EXISTS DOD_PRD_CATG; SELECT 'DROPPING PRODUCT CATEGORIES TABLE.';
 DROP TABLE IF EXISTS DOD_CUST_PROFILE; SELECT  'DROPPING CUSTOMER PROFILE TABLE.';
 DROP TABLE IF EXISTS DOD_VEND_PROFILE; SELECT 'DROPPING VENDOR PROFILE TABLE'; 
 DROP TABLE IF EXISTS DOD_USERS; SELECT 'DROPPING USERS TABLE'; 
DROP TABLE IF EXISTS DOD_REVIEWS; SELECT 'DROPPING REVIEWS TABLE';
DROP TABLE IF EXISTS DOD_VENDOR_ORDERS;  SELECT 'A TABLE TO STORE ALL THE ORDERS FOR A PARTICULAR VENDOR.';

 SELECT 'TABLES DROPPED' AS ' ';

 SELECT 'CREATING TABLE DOD_USERS' AS ' ';    
CREATE TABLE DOD_USERS( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 NAME VARCHAR(30) NOT NULL ,
 USERNAME VARCHAR(30) NOT NULL UNIQUE ,
 PASSWORD VARCHAR(100) NOT NULL ,
 EMAIL VARCHAR(255) NOT NULL,
 FIRSTNAME VARCHAR(50), 
 LASTNAME VARCHAR(50), 
 FULLNAME VARCHAR(50), 
 SALUTATION VARCHAR(10), 
 TITLE VARCHAR(255), 
 PHONE_HOME VARCHAR(50), 
 PHONE_MOBILE VARCHAR(50), 
 PHONE_OFFICE VARCHAR(50), 
 PRIMARY_ADDRESS_STREET VARCHAR(150), 
 PRIMARY_ADDRESS_CITY VARCHAR(100), 
 PRIMARY_ADDRESS_STATE VARCHAR(100), 
 PRIMARY_ADDRESS_POSTALCODE VARCHAR(20), 
 PRIMARY_ADDRESS_COUNTRY VARCHAR(255), 
 BIRTHDATE DATETIME, 
 PICTURE VARCHAR(255),
 CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 CREATED_BY MEDIUMINT,
 UPDATED TIMESTAMP ,
 UPDATED_BY MEDIUMINT,
 ACTIVE_FLG CHAR(1),
 DELETED_STATE CHAR(1),
 TENANT_ID MEDIUMINT NOT NULL, 
PARENT_ID MEDIUMINT  );
 
 SELECT 'CREATING TABLE DOD_COMPANY' AS ' ';
CREATE TABLE DOD_COMPANY( ROW_ID MEDIUMINT AUTO_INCREMENT     PRIMARY KEY ,
 NAME VARCHAR(255) NOT NULL ,
 ADDRESS VARCHAR(512) NOT NULL ,
 CITY VARCHAR(256) NOT NULL,
 STATE VARCHAR(256),
 COUNTRY VARCHAR (100),
 ZIPCODE CHAR(10),
 PRIMARY_CONTACT VARCHAR(255), 
 CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
  CREATED_BY MEDIUMINT,
  UPDATED TIMESTAMP ,
  UPDATED_BY MEDIUMINT,
  ACTIVE_FLG CHAR(1) NOT NULL,
 DELETED_STATE CHAR(1));
 
SELECT 'CREATING TABLE DOD_PRD_PREF' AS ' ';
CREATE TABLE DOD_ORD_PREF( ROW_ID MEDIUMINT AUTO_INCREMENT     PRIMARY KEY ,
 CUST_ID MEDIUMINT, 
 PRD_ID MEDIUMINT, 
 PRD_QTY MEDIUMINT,
SUN CHAR(1),
MON CHAR(1),
TUE CHAR(1),
WED CHAR(1),
THU CHAR(1),
FRI CHAR(1),
SAT CHAR(1),
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 TENANT_ID MEDIUMINT, 
 DELETED_STATE CHAR(1)
 );
  
SELECT  'THIS IS A DAILY TRANSACTION TABLE TO CALCULATE THE DEMAND FOR THE PRODUCT ON A DAILY BASIS.';
SELECT  'WE CAN COPY THE ROWS FROM DOD_PRD_PREF TABLE BY RUNNING A DAILY JOB AND CONSIDER THAT AS DAILY ONDEMAND PREFERENCE'; 
SELECT 'CREATING TABLE DOD_ORDER' AS ' ';    
CREATE TABLE DOD_ORDER( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 ORD_DATE TIMESTAMP NOT NULL DEFAULT NOW(), 
 CUST_ID MEDIUMINT NOT NULL, 
 REQ_DATE TIMESTAMP NOT NULL, 
 SHIPPED_DATE TIMESTAMP NULL, 
 SHIP_ADDRESS VARCHAR(100),
ORDER_FULFILLED CHAR(1),
STATUS 	CHAR(3),
CONTEXT_ID VARCHAR(100), 
ORDER_AMT DECIMAL(7,2),
COMMENTS VARCHAR(255), 
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 TENANT_ID MEDIUMINT,
 DELETED_STATE CHAR(1));
 
SELECT 'CREATING TABLE DOD_ORD_DETAILS' AS ' ';    
CREATE TABLE DOD_ORDER_DETAILS( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 ORDER_ID MEDIUMINT NOT NULL, 
 VENDOR_ID MEDIUMINT NOT NULL, 
PRD_ID MEDIUMINT NOT NULL, 
 UNIT_PRICE DECIMAL(7,2), 
 PRD_QTY MEDIUMINT,
 FULFILLED CHAR(1),
 STATUS CHAR(3), 
 CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 DELETED_STATE CHAR(1),
 TENANT_ID MEDIUMINT 
);

SELECT 'CREATING TABLE DOD_VENDOR_ORDERS' AS ' ';    
CREATE TABLE DOD_VENDOR_ORDERS( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
 ORDER_ID MEDIUMINT NOT NULL, 
 VENDOR_ID MEDIUMINT NOT NULL, 
 FULFILLED CHAR(1),
 STATUS CHAR(3), 
 CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 TENANT_ID MEDIUMINT 
);



SELECT 'CREATING TABLE DOD_ORDER_TRACK' AS ' ';
CREATE TABLE DOD_ORDER_TRACK (ROW_ID MEDIUMINT AUTO_INCREMENT PRIMARY KEY,
ORDER_ID MEDIUMINT NOT NULL,
STATUS  CHAR(3),
REMARKS VARCHAR(70),
UPDATED_BY VARCHAR(70),
TENANT_ID MEDIUMINT,
UPDATED TIMESTAMP, 
CREATED TIMESTAMP NOT NULL DEFAULT NOW()); 

SELECT 'CREATING TABLE DOD_ORDER_DETAILS_TRACK' AS ' ';
CREATE TABLE DOD_ORDER_DETAILS_TRACK (ROW_ID MEDIUMINT AUTO_INCREMENT PRIMARY KEY,
ITEM_ID MEDIUMINT NOT NULL,
STATUS  CHAR(3),
REMARKS VARCHAR(70),
UPDATED_BY VARCHAR(70),
UPDATED TIMESTAMP, 
TENANT_ID MEDIUMINT,
CREATED TIMESTAMP NOT NULL DEFAULT NOW()); 



 
SELECT 'CREATING TABLE DOD_PRD_MASTER' AS ' ';    
CREATE TABLE DOD_PRD_MASTER( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
PRD_NAME VARCHAR(70),
VENDOR_ID MEDIUMINT, 
CATG_ID MEDIUMINT, 
QTY_PER_UNIT VARCHAR(30), 
PRD_IMAGE_PATH VARCHAR(256),
UNIT_PRICE DECIMAL(7,2),
UNITS_IN_STOCK SMALLINT, 
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 DELETED_STATE CHAR(1),
 SUBSCRIBE_FLAG CHAR(1), 
 TENANT_ID MEDIUMINT 
);

SELECT 'CREATING TABLE DOD_PRD_CAT' AS ' ';
CREATE TABLE DOD_PRD_CATG (ROW_ID MEDIUMINT AUTO_INCREMENT PRIMARY KEY,
CATG_NAME VARCHAR(70),
DESCRIPTION VARCHAR(100),
PICTURE_PATH VARCHAR(255),
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 DELETED_STATE CHAR(1),
 ACTIVE_FLAG CHAR(1), 
 TENANT_ID MEDIUMINT);
 


SELECT 'CREATING TABLE DOD_CUST_PROFILE' AS ' ';    
CREATE TABLE DOD_CUST_PROFILE( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
NAME  VARCHAR(70) NOT NULL ,
ADDRESS VARCHAR(256),
PHONE VARCHAR(30) NOT NULL UNIQUE,
USERNAME VARCHAR(30) ,
PASSWORD VARCHAR(100) ,
EMAIL VARCHAR(255),
 FIRSTNAME VARCHAR(50), 
 LASTNAME VARCHAR(50), 
 FULLNAME VARCHAR(50), 
 SALUTATION VARCHAR(10), 
 TITLE VARCHAR(255), 
 BIRTHDATE DATETIME,
 PICTURE_PATH VARCHAR(256),
 CITY VARCHAR(256),
 STATE VARCHAR(256),
 COUNTRY VARCHAR (100),
 ZIPCODE CHAR(10),
WALLET_BALANCE DECIMAL(7,2) DEFAULT 0.00,  
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
 UPDATED TIMESTAMP, 
 DELETED_STATE CHAR(1),
 TENANT_ID MEDIUMINT NOT NULL

);

SELECT 'CREATING TABLE DOD_VEND_PROFILE' AS ' ';    
CREATE TABLE DOD_VEND_PROFILE( ROW_ID MEDIUMINT AUTO_INCREMENT    PRIMARY KEY ,
NAME  VARCHAR(70) NOT NULL,
ADDRESS VARCHAR(70) NOT NULL, 
PHONE VARCHAR(30) NOT NULL UNIQUE, 
 USERNAME VARCHAR(30) NOT NULL ,
 PASSWORD VARCHAR(100) NOT NULL ,
 EMAIL VARCHAR(255) NOT NULL,
 FIRSTNAME VARCHAR(50), 
 LASTNAME VARCHAR(50), 
 FULLNAME VARCHAR(50), 
 SALUTATION VARCHAR(10), 
 TITLE VARCHAR(255), 
 BIRTHDATE DATETIME,
 PICTURE_PATH VARCHAR(256),
 CITY VARCHAR(256),
 ZIPCODE VARCHAR(10), 
 STATE VARCHAR(256),
 COUNTRY VARCHAR (100),
CREATED TIMESTAMP NOT NULL DEFAULT NOW() ,
UPDATED TIMESTAMP , 
 DELETED_STATE CHAR(1),
 TENANT_ID MEDIUMINT NOT NULL

);

SELECT 'CREATING TABLE DOD_REVIEWS' AS ' ';
CREATE TABLE DOD_REVIEWS (ROW_ID MEDIUMINT AUTO_INCREMENT PRIMARY KEY,
RATING SMALLINT DEFAULT 0,
CREATED TIMESTAMP NOT NULL DEFAULT NOW(),
DESCRIPTION VARCHAR(256),
DELETED_STATE CHAR(1),
TENANT_ID MEDIUMINT,
PRODUCT_ID MEDIUMINT ,
CUSTOMER_ID MEDIUMINT,
TRANSACTION_ID MEDIUMINT);




-- CREATE FOREIGN KEY REFERENCES : DOD_REVIEWS TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_REVIEWS TABLE' AS ' ';
ALTER TABLE DOD_REVIEWS ADD FOREIGN KEY(TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID);
ALTER TABLE DOD_REVIEWS ADD FOREIGN KEY (PRODUCT_ID) REFERENCES DOD_PRD_MASTER(ROW_ID);
ALTER TABLE DOD_REVIEWS ADD FOREIGN KEY (CUSTOMER_ID) REFERENCES DOD_CUST_PROFILE(ROW_ID);
ALTER TABLE DOD_REVIEWS ADD FOREIGN KEY (TRANSACTION_ID) REFERENCES DOD_ORDER (ROW_ID);



-- CREATE FOREIGN KEY REFERENCES : DOD_ORD_PREF TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_ORD_PREF TABLE' AS ' '; 
ALTER TABLE DOD_ORD_PREF ADD FOREIGN KEY( TENANT_ID)   REFERENCES DOD_COMPANY(ROW_ID); 
ALTER TABLE DOD_ORD_PREF ADD FOREIGN KEY( CUST_ID)   REFERENCES DOD_CUST_PROFILE(ROW_ID); 
ALTER TABLE DOD_ORD_PREF ADD FOREIGN KEY( PRD_ID)   REFERENCES DOD_PRD_MASTER(ROW_ID); 


-- CREATE FOREIGN KEY REFERENCES : DOD_ORDER TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_ORDER' AS ' ';
ALTER TABLE DOD_ORDER ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID); 
ALTER TABLE DOD_ORDER ADD FOREIGN KEY( CUST_ID)   REFERENCES DOD_CUST_PROFILE(ROW_ID);






-- CREATE FOREIGN KEY REFERENCES : DOD_ORDER_DETAILS TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_ORDER_DETAILS TABLE' AS ' ';
ALTER TABLE DOD_ORDER_DETAILS ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID); 
ALTER TABLE DOD_ORDER_DETAILS ADD FOREIGN KEY( ORDER_ID)   REFERENCES DOD_ORDER(ROW_ID); 
ALTER TABLE DOD_ORD_PREF ADD FOREIGN KEY( PRD_ID)   REFERENCES DOD_PRD_MASTER(ROW_ID); 

-- CREATE FOREIGN KEY REFERENCES : DOD_VENDOR_ORDER TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES: DOD_VENDOR_ORDER  TABLE' AS ' ';
ALTER TABLE DOD_VENDOR_ORDERS ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID);


-- CREATE FOREIGN KEY REFERENCES : DOD_ORDER_TRACK TABLE
SELECT 'CREATE FOREIGN KEY REFERENCES: DOD_ORDER_STATUS TABLE' AS ' ';
ALTER TABLE DOD_ORDER_TRACK ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID);
ALTER TABLE DOD_ORDER_TRACK ADD FOREIGN KEY (ORDER_ID) REFERENCES DOD_ORDER(ROW_ID); 


-- CREATE FOREIGN KEY REFERENCES : DOD_PRD_MASTER
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_PRD_MASTER ' AS ' ';
ALTER TABLE DOD_PRD_MASTER ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID); 
ALTER TABLE DOD_PRD_MASTER ADD FOREIGN KEY (VENDOR_ID)   REFERENCES DOD_VEND_PROFILE(ROW_ID); 
ALTER TABLE DOD_PRD_MASTER ADD FOREIGN KEY (CATG_ID) REFERENCES bDOD_PRD_CATG(ROW_ID); 

-- CREATE FOREIGN KEY REFERENCES : DOD_CUST_PROFILE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_CUST_PROFILE TABLE' AS ' ';
ALTER TABLE DOD_CUST_PROFILE ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID); 

-- CREATE FOREIGN KEY REFERENCES : DOD_VEND_PROFILE
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_VEND_PROFILE TABLE' AS ' ';
ALTER TABLE DOD_VEND_PROFILE ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID);

-- CREATE FOREIGN KEY REFERENCES : DOD_USERS
SELECT 'CREATE FOREIGN KEY REFERENCES : DOD_USERS TABLE' AS ' ';
ALTER TABLE DOD_USERS ADD FOREIGN KEY (TENANT_ID) REFERENCES DOD_COMPANY(ROW_ID);
ALTER TABLE DOD_USERS ADD FOREIGN KEY (PARENT_ID) REFERENCES DOD_USERS(ROW_ID);

-- ALTER TABLE DOD_CUST_PROFILE ADD UNIQUE KEY
ALTER IGNORE TABLE DOD_CUST_PROFILE  ADD UNIQUE (PHONE);

-- ALTER TABLE DOD_VEND_PROFILE ADD UNIQUE KEY 
ALTER IGNORE TABLE DOD_VEND_PROFILE  ADD UNIQUE (PHONE);





-- AFTER CREATING ALL THE TABLES WE NEED TO INSERT THE DEFAULT COMPANY AND USER.



-- CREATE DEMO COMPANY
SELECT 'CREATE ACME COMPANY' AS ' ';
INSERT INTO DOD_COMPANY(NAME, ADDRESS, PRIMARY_CONTACT,ACTIVE_FLG,DELETED_STATE, 
CREATED,CREATED_BY, UPDATED, UPDATED_BY) VALUES("demo", "BANGALORE", "SUPERADMIN", 'Y','N', CURDATE(),-1,CURDATE(),-1); 


-- CREATE DEMO USER
SELECT 'CREATE DEMO  USER' AS ' ';
INSERT INTO DOD_USERS(NAME ,
 USERNAME ,
 PASSWORD ,
 CREATED ,
 CREATED_BY ,
 UPDATED ,
 UPDATED_BY ,
 TENANT_ID, 
 ACTIVE_FLG,
 DELETED_STATE ) VALUES("demo", "demo", "demo", CURDATE(), -1, CURDATE(), -1, 1,'Y','N'); 


